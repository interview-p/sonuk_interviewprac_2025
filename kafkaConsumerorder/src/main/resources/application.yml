spring:
  kafka:
    bootstrap-servers: localhost:19092,localhost:19093,localhost:19094,localhost:19095,localhost:19096

    consumer:
      group-id: cg-demo

      # ✅ REQUIRED for manual ack + retry safety
      enable-auto-commit: false

      # ✅ Safe reprocessing
      auto-offset-reset: earliest

      # ❌ Not used when auto-commit=false (kept for clarity)
      auto-commit-interval: 1000

      # ✅ Use String → JSON handled in code / factory
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer

      properties:
        # ✅ Safe Kafka consumer (no dirty reads)
        isolation.level: read_committed

        # ✅ Backpressure control (important for retries)
        fetch.min.bytes: 100000
        fetch.max.wait.ms: 20000

        # ✅ Prevent rebalance during long retries
        max.poll.interval.ms: 600000

        # ✅ Batch size per poll
        max.poll.records: 10

    listener:
      # ✅ REQUIRED for manual acknowledgment
      ack-mode: manual

      # ✅ Multithreading (can be overridden per listener)
      concurrency: 3

      # ✅ Stop consumer if fatal issue occurs
      missing-topics-fatal: false

    producer:
      # ✅ Safe producer (important for DLQ + retries)
      acks: all
      retries: 5
      linger-ms: 5
      enable-idempotence: true

      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer

      properties:
        # ✅ Avoid duplicate writes on retry
        max.in.flight.requests.per.connection: 5
